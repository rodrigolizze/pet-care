<div class="container py-3">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="m-0">Painel do cuidador</h1>
    <%= link_to new_availability_path, class: "btn btn-success d-inline-flex align-items-center gap-2" do %>
      <i class="bi bi-calendar-plus"></i><span>Adicionar Disponibilidade</span>
    <% end %>
  </div>

  <!-- Welcome -->
  <div class="alert alert-info">
    Bem-vindo, <strong><%= current_user.name %></strong>! Aqui você pode gerenciar suas disponibilidades e ver informações do seu perfil.
  </div>

  <!-- Minhas Disponibilidades -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-light">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-calendar3 text-success"></i>
        <h2 class="h6 m-0">Minhas Disponibilidades</h2>
      </div>
    </div>

    <div class="card-body p-0">
      <% if @availabilities.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle m-0">
            <thead class="table-light">
              <tr>
                <th>Data</th>
                <th style="width:160px;">Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @availabilities.each do |availability| %>
                <tr>
                  <td class="fw-semibold"><%= availability.date.strftime("%d/%m/%Y") %></td>
                  <td>
                    <%= button_to "Excluir",
                          availability_path(availability),
                          method: :delete,
                          data: { confirm: "Tem certeza que deseja excluir esta disponibilidade?" },
                          class: "btn btn-sm btn-outline-danger rounded-pill" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="p-4">
          <div class="alert alert-secondary m-0">Você ainda não adicionou nenhuma disponibilidade.</div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="row g-4">
    <!-- Sobre Mim -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-light">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-person text-primary"></i>
            <h2 class="h6 m-0">Sobre Mim</h2>
          </div>
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-0">
            <li class="mb-2"><strong>Nome:</strong> <%= current_user.name %></li>
            <li class="mb-2"><strong>Bio:</strong> <%= current_user.bio.presence || "Nenhuma bio fornecida." %></li>
            <li class="mb-2"><strong>Experiência:</strong> <%= current_user.experience.presence || "Nenhuma experiência informada." %></li>
            <li class="mb-0"><strong>Cidade:</strong> <%= current_user.city.presence || "Não informada" %></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Como é a hospedagem -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-light">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-house-door text-primary"></i>
            <h2 class="h6 m-0">Como é a hospedagem</h2>
          </div>
        </div>
        <div class="card-body">
          <% size_map = { "small" => "Pequeno", "medium" => "Médio", "big" => "Grande", "all" => "Todos os portes" } %>
          <% size_label = size_map[current_user.animal_sizes] || "Não informado" %>

          <ul class="list-unstyled mb-0">
            <li class="mb-2">
              <strong>Moro em:</strong>
              <%= current_user.property_type == "house" ? "Casa" :
                  (current_user.property_type == "apartment" ? "Apartamento" : "Não informado") %>
            </li>
            <li class="mb-2">
              <strong>Aceito animais de porte:</strong> <%= size_label %>
            </li>
            <li class="mb-2">
              <strong>Possui área externa:</strong> <%= current_user.backyard ? "Sim" : "Não" %>
            </li>
            <li class="mb-2">
              <strong>Tem outros animais:</strong> <%= current_user.has_pet ? "Sim" : "Não" %>
            </li>
            <li class="mb-0">
              <strong>Janelas teladas:</strong> <%= current_user.screened_windows ? "Sim" : "Não" %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <% if current_user.place_photos.attached? %>
    <!-- Galeria do espaço -->
    <div class="card shadow-sm border-0 mt-4">
      <div class="card-header bg-light">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-images text-primary"></i>
          <h2 class="h6 m-0">Minhas fotos do espaço</h2>
        </div>
      </div>
      <div class="card-body">
        <div class="row row-cols-2 row-cols-md-3 g-3">
          <% current_user.place_photos.each do |photo| %>
            <div class="col">
              <div class="card h-100 border-0 shadow-sm">
                <div class="ratio ratio-4x3">
                  <%= image_tag url_for(photo),
                        class: "img-fluid w-100 h-100 rounded-top",
                        style: "object-fit: cover; cursor: zoom-in;",
                        data: { bs_toggle: "modal", bs_target: "#photoModal#{photo.id}" } %>
                </div>
                <div class="card-body p-2 d-flex justify-content-between align-items-center">
                  <span class="text-muted small">Visualizar</span>
                  <%= button_to "Remover",
                        remove_place_photo_users_path(photo.id),
                        method: :delete,
                        data: { confirm: "Tem certeza que deseja remover esta foto?" },
                        class: "btn btn-outline-danger btn-sm rounded-pill" %>
                </div>
              </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="photoModal<%= photo.id %>" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                  <div class="modal-body p-0">
                    <%= image_tag url_for(photo), class: "img-fluid w-100" %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <div class="mt-3">
    <%= link_to "✏️ Editar informações", edit_sitter_users_path, class: "btn btn-primary" %>
  </div>
</div>
