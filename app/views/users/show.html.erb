<h1>Perfil de <%= @user.name %></h1>

<p><strong>Endereço:</strong> <%= @user.address %></p>
<p><strong>Email:</strong> <%= @user.email %></p>

<h2>Datas disponíveis</h2>

<% if @availabilities.any? %>
  <ul>
    <% @availabilities.each do |availability| %>
      <li style="margin-bottom: 0.75rem;">
        <strong><%= availability.date.strftime("%d/%m/%Y") %></strong>

        <% if availability.booking.present? %>
          <% b = availability.booking %>
          <% if current_user == @user || current_user == b.user %>
            <%= button_to "Cancelar reserva",
                          availability_booking_path(availability, b),
                          method: :delete,
                          data: { confirm: "Tem certeza que deseja cancelar?" },
                          class: "btn btn-sm btn-danger",
                          style: "margin-left: 8px;" %>
          <% end %>
          <div style="margin-top: 4px;">
            <span class="badge bg-secondary">Reservado</span>
            <div>
              <em>Cliente:</em> <%= b.user.name %> (<%= b.user.email %>)
            </div>
            <div>
              <em>Pet:</em> <%= b.pet_name %> —
              <%= b.animal_type %>, <%= b.pet_size %>,
              nasc. <%= b.pet_birth_year %>
            </div>
          </div>
        <% else %>
          <%= link_to "Reservar", new_availability_booking_path(availability),
                      class: "btn btn-sm btn-primary", style: "margin-left: 8px;" %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>Este cuidador não possui datas disponíveis.</p>
<% end %>
